SELECT
    CASE
        WHEN age.CARRY_FORWORD_EXP_DATE >= TO_CHAR(SYSDATE, 'MM/DD/YYYY')
            THEN (age.PLAN_YEAR_ACCRUED + age.CARRY_FORWARD)
        ELSE age.PLAN_YEAR_ACCRUED
    END AS LEAVE_ENTITLEMENT,
    to_char(age.PLAN_YEAR_ACCRUED,'90.9') as PLAN_YEAR_ACCRUED,
    CASE
        WHEN age.CARRY_FORWORD_EXP_DATE >= TO_CHAR(SYSDATE, 'MM/DD/YYYY')
            THEN age.CARRY_FORWARD
        ELSE 0
    END AS CARRY_FORWARD,
    (age.PLAN_YEAR_USED + age.CARRY_FORWARD_USED) AS ANPL_USED,
    CASE
        WHEN age.CARRY_FORWORD_EXP_DATE >= TO_CHAR(SYSDATE, 'MM/DD/YYYY')
            THEN age.AVAILABLE + age.CARRY_FORWARD_AVALABLE
        ELSE age.AVAILABLE
    END AS ANPL_BALANCE
FROM
    ABSENCE_GROUP_EMPLOYEE age
WHERE
    age.EMPLOYEE_CODE = :APP_EMP_CODE
    AND age.HRM_ABSENCE_CODE_GROUP_ID LIKE 'APL';
